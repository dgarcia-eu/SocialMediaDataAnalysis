<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Supervised Social Media Text Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="David Garcia    University of Konstanz" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="libs/footer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Supervised Social Media Text Analysis
]
.author[
### David Garcia <br><br> <em>University of Konstanz</em>
]
.date[
### Social Media Data Analysis
]

---







layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;David Garcia - Soxial Media Data Analysis&lt;/span&gt;&lt;/div&gt; 

---

# So Far

- **Block 1: Introduction**
  - Introduction to social media data analysis within social data science
  - Algorithms and digital traces: The case of Google trends
  - Ethics and privacy in social media data analysis


- **Block 2: Social dynamics**
  - Social impact theory and its application to social media
  - Social trends and the Simmel effect


- **Block 3: Text in social media**
  - Dictionary methods in social media data analysis
      - Emotion measurement
      - Basics of dictionary methods and their application to sentiment analysis
      - Application examples of dictionary methods
---

# Outline

## 1. When dictionary methods go wrong

## 2. Supervised methods in NLP

## 3. Comparing methods in SMDA


---

#  The digital traces of pagers

.center[![:scale 50%](https://upload.wikimedia.org/wikipedia/commons/2/27/Dme_motorola.jpg)]
Back in the 90s, [pagers](https://en.wikipedia.org/wiki/Pager) were a common form of mobile communication. To send a message to a pager, you could call a special phone number, say your message, and the text of the message would appear in the screen of the pager.


---
#  Emotions in pagers after 9/11 
.center[![:scale 95%](PsychSci.png)]

[The Emotional Timeline of September 11, 2001. Mitja D. Back, Albrecht C.P. Küfner, and Boris Egloff. Psychological Science (2010)](https://journals.sagepub.com/doi/full/10.1177/0956797610382124)

---
.center[![:scale 69%](anger911Timeline.png)]
---

## Not so angry americans
More than a third of anger words appeared in messages like these:
![:scale 100%](PagersExample.png)
"Reboot NT machine [name] in cabinet [name] at [location]:CRITICAL:[date and time]."  

The word "critical" is contained in the anger word list of LIWC!

---

### Anger timeline without REBOOT messages
.center[![:scale 87%](notSoAngry.png)]

---

## The issue of machine-generated traces

&lt;div style="float:right"&gt;
&lt;img src="https://botometer.osome.iu.edu/static/assets/img/banner-logo.png" alt="Botometer" width="400px"/&gt;  
&lt;/div&gt;

Not all digital traces are generated by humans, a large volume of data is generated by machines. 

During the summer of 2018, Twitter made a big bot cleanse, but independent estimates before reported that between [9% and 15% of Twitter accounts were likely to be bots](https://ojs.aaai.org/index.php/ICWSM/article/view/14871/14721). 

One of the most widely used methods to detect bots on Twitter is [Botometer](https://botometer.osome.iu.edu/), which is in constant development by the [OSoMe lab at Indiana University](https://osome.iu.edu/).
Even if you clean bots from your data, you should always take a good look at your text. You can make word clouds, word shift graphs, or just browse through it to see if you notice anomalous patterns. To sum up:

&gt; Take home message: Do not just analyze text, also look at it!


---

# Supervised methods in NLP

## 1. When dictionary methods go wrong

## *2. Supervised methods in NLP*

## 3. Comparing methods in SMDA
---

# Representations of text

**Text representation:** computing a fixed-length vector from a text to train a model on the features (values) of the vector

- **TF (Term Frequency) vector:** Using a bag of words assumption, represent each text as a vector of frequencies of the words in the language

- **TF-IDF (Term Frequency - Inverse Document Frequency):** Same but dividing by the total frequency of the term in all documents
  - Both TF and TF-IDF generate very long vectors (number of possible words) with many zeroes
  - Some approaches to remove rare words or uninformative stopwors
  - Requires design decisions: include punctuation? stem words?

- **Denser representations:** More on those next week

---

# How to train your model
.center[![:scale 65%](supervisedPhases.png)] 

1. **Training:** Texts with annotations of sentiment are used to fit the model  
2. **Validation:** A second set of annotated texts not used for training are used to evaluate the quality of the model: `\(Q_{1}\)`  
3. **Testing:** One last evaluation run of the fitted model with a leave-out sample of annotated texts. None of these texts should have been part of the validation or training steps. Testing quality `\(Q_2\)` measures predictive quality of the model.
---

# Be extra careful with test sets
.center[![:scale 100%](TestTraining.png)] 

---

# Gold Standards and Ground Truths


pos | neg | text  
------------- | ------------- | -------------
0 | 0 |  I wana see the vid Kyan  
0 | 1 | I cant feel my feet.. that cant be good..  
1 | 0 | 10 absolutely jaw dropping concept car designs http://ow.ly/15OnX  
0 | 0 | Phil Collins- You Can’t Hurry Love

- Supervised sentiment analysis needs a set of labeled texts to learn from.
- Labels can come from the author of the text or from reading raters
- The above table is an example from a real dataset with two annotations: a positivity score and a negativity score
- Other ground truths  might have numeric scores in a scale or text labels for basic emotional states.

---

# Text preprocessing

.center[![:scale 75%](http://res.cloudinary.com/dyd911kmh/image/upload/f_auto,q_auto:best/v1535125878/NLTK3_zwbdgg.png)]

Pre-processing from [Text Analytics for Beginners using NLTK, Navlani, 2019](https://www.datacamp.com/community/tutorials/text-analytics-beginners-nltk)

---

# What model to use?

Common approaches are:  
1. **Naive Bayes:** Takes features as independent signals and fits the label according to Bayes Rule  
2. **Support Vector Machine:** Finds a separator given a (non-)linear combination of features  
3. **Random Forest:** Finds hierarchical decision rules that divide the texts in classes

In supervised sentiment analysis, generating the ground truth data is the most critical part and is required to train the model. Producing sufficient annotations from readers or authors can be expensive. Supervised methods are usually not out-of-the-box like unsupervised tools, you would have to fit your own model to a ground truth dataset.

---
&lt;div style="float:right"&gt;
&lt;img src="Precisionrecall.png" alt="Precision and Recall" width="480px"/&gt;
&lt;/div&gt;
# Evaluating classifiers 

- True positives `\(TP\)`: All positive cases that are correctly predicted

- False positives `\(FP\)`: All negatives that were wrongly predicted as positive

- True negatives `\(TN\)`: All negative cases that are correctly predicted 

- False negatives `\(FN\)`: All positive cases that were incorrectly predicted as negative

---

# Accuracy, Precision, and Recall
`$$Accuracy = \frac{TP+TN}{TP+FP+TN+FN}$$`
`$$Precision = \frac{TP}{TP+FP}$$`
`$$Recall = \frac{TP}{TP+FN}$$`  
- The measure of precision answers the question "How sure am I of this prediction?"
- The measure of recall answers the question  "How many of the things that I’m looking for are found?"

---

# Balancing precision and recall

A way to compute a trade-off between Precision and Recall is the `\(F_1\)` score, which is a harmonic mean of Precision and Recall:

`$$F_1= 2 ∗ \frac{ Precision ∗ Recall} {Precision + Recall}$$`

The `\(F_1\)` score is often used as a way to summarize the quality of classifiers. When more than one class is possible, you should look at the mean of `\(F_1\)` over the classess or to the `\(F_1\)` of each class separately. The `\(F_1\)` score is often used in sentiment analysis competitions to chose the best tools, for example in the [SemEval 2017 competition](https://alt.qcri.org/semeval2017/index.php?id=tasks).

---

# Let someone else do it: Black-box APIs

.center[![:scale 53%](IBMNLP.png)![:scale 47%](GoogleNLP.png)]

Easy to use but data and methods unknown. Do your own evaluation!

---

.center[![:scale 43%](Mind.jpeg)]

---

# Comparing methods in SMDA

## 1. When dictionary methods go wrong

## 2. Supervised methods in NLP

## *3. Comparing methods in SMDA*

---

# Benchmarking sentiment analysis

.center[![:scale 100%](Benchmark.png)]
[SentiBench - a benchmark comparison of state-of-the-practice sentiment analysis methods
F. Ribeiro, et al. EPJ Data Science (2016)](https://epjdatascience.springeropen.com/articles/10.1140/epjds/s13688-016-0085-1)

---

# Benchmark setup

.center[![:scale 80%](datasets.png)]
- 18 labeled datasets in three groups: Social networks, coomments, reviews
- 24 out-of-the box sentiment analysis methods
  - includes dictionary-based (LIWC, NRC)
  - rule-based (VADER, SentiStrength)
  - some supervised methods (SASA)
- Two tasks:
  - 2-class (positive/negative), given that it is not neutral
  - 3-class (positive/negative/neutral)
- Evaluation based on `\(F_1\)` score per class - summary as mean rank of methods



---
## Mean `\(F_1\)` across datasets
.center[![:scale 60%](SentiBench.jpg)]

---

# Ranking for social network data
.center[![:scale 100%](Top10.png)]

---


# Validity of using text analysis at scale?

.pull-left[
&lt;img src="figures/Macy.jpg" width="1100" /&gt;
&lt;font size="5"&gt;
&lt;a href="https://science.sciencemag.org/content/333/6051/1878/"&gt; Diurnal and seasonal mood vary with work, sleep, and daylength across diverse cultures. Golder &amp; Macy, Science (2011) &lt;/a&gt;
&lt;/font&gt;
]

.pull-right[
&lt;img src="figures/hedonometer.png" width="1100" /&gt;

&lt;font size="5"&gt;
&lt;a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0026752"&gt; Temporal patterns of happiness and information in a global social network: Hedonometrics and Twitter. Dodds et al. PLoS One (2011) &lt;/a&gt;
&lt;/font&gt;
]

---

# Validating a UK emotion macroscope

&lt;img src="figures/MacroTest2.svg" width="975" style="display: block; margin: auto;" /&gt;

---


# Validating a UK emotion macroscope
1. Two years of weekly representative UK emotion survey by YouGov
2. UK Twitter data for the same period: 1.5 Billion tweets (without RT)
3. Text analysis: dictionary-based (LIWC) and supervised (RoBERTa)
4. Gender detection of twitter users based on profile
5. Gender-rescaled time series of emotional expression

&lt;img src="figures/Data.svg" width="900" style="display: block; margin: auto;" /&gt;

---
# Sadness in Twitter and YouGov

&lt;img src="figures/Sadness.svg" width="1200" style="display: block; margin: auto;" /&gt;

- Similar results with dictionary-based and supervised (r~0.65)
---

# Anxiety in Twitter and YouGov

&lt;img src="figures/Anxiety.svg" width="1200" style="display: block; margin: auto;" /&gt;

- Better results with dictionary-based method and with gender rescaling
- Results robust to autocorrelation and heteroskedasticity

---

# Joy in Twitter and YouGov

&lt;img src="figures/Joy.svg" width="1200" style="display: block; margin: auto;" /&gt;

- Substantially better results with supervised method than dictionary-based
---

# Exploring 12 emotional states
.pull-left[

- Time series of number sentences like "I am [emotion]" on Twitter

- Weak correlations happen for infrequent emotions in text

- Comparison: US weekly pre-election polls correlate with 0.66

- Arxiv preprint at https://arxiv.org/abs/2107.13236

]

.pull-right[
&lt;img src="figures/Figure2.svg" width="700" /&gt;
]

---

layout: true
&lt;div class="my-footer"&gt;&lt;span&gt;
Validating daily social media macroscopes of emotions. Max Pellert, Hannah Metzler, Michael Matzenberger, David Garcia. Scientific Reports (2022)&lt;/span&gt;&lt;/div&gt;

---

## Study 2: Validating an Austrian macroscope

.pull-left[

- 20-day emotion survey in derstandard.at (N=268,128)
- Daily frequency, 3-day windows

- Text from Der Standard forum (N=452,013)

- Austrian tweets (N=515,187) filtered as UK macroscope

- Compared dictionary-based (LIWC) and supervised model (GS)

]
.pull-right[
&lt;img src="figures/DS1.svg" width="800" /&gt;
]

---

## Twitter sentiment and Der Standard survey

&lt;img src="figures/DS2.svg" width="1000" style="display: block; margin: auto;" /&gt;

---

# Correlations with new COVID-19 cases

.pull-left[
&lt;img src="figures/DS31.svg" width="600" /&gt;
]
.pull-right[
&lt;img src="figures/DS32.svg" width="600" /&gt;
]

- Do correlations attenuate due to additional social media measurement error?
- Survey emotion correlation with new cases as strong as Twitter sentiment
- Errors sources might be different: Need for conceptual validations

---
# Summary

- When dictionary methods go wrong
  - The case of LIWC on pagers after 9/11
  - Reading the data matters! Visualizations, random samples, etc


- Supervised methods
  - Gold standards as annotated texts
  - The importance of the separation of training and test
  - Evaluation: Precision, Recall, and `\(F_1\)`


- Comparing and evaluation methods
  - SentiBench: a 2016 benchmark to compare methods
  - Validations beyond documents: time series in the UK and Austria
  
  
---

# Form for input on exam date

.pull-left[
- Exam room space very limited

- No central coordination for exam conflicts among elective courses

- Two options for exam date:
  - 25.07 10:00-11:30
  - 26.07 10:00-11:30

- Fill the form today if you prefer one!

https://forms.gle/F5JzCv4L6ZGtX7Fu9
]

.pull-right[
.center[![:scale 90%](QR.png)]
]




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="libs/perc.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
